<!DOCTYPE html>
<html>

<%- include('partials/head', {
  pageTitle: 'Prepare - ' + prep.deck.name + ' - MTG Deck Shuffler',
  additionalStyles: ['/playmat.css', '/prepare.css']
}) %>

<body>
  <div class="prepare-page">
    <%- include('partials/header', {  
      activePage: 'play',
      playLinkText: 'restart',
      linksInNewTabs: true
    }) %>

    <main class="prepare-container">
        <div class="playmat">
          <div id="library-section" class="section-that-is-horizontally-aligned-with-command-zone" data-testid="library-section">
            <%- renderLibraryStack() %>
            <div class="library-buttons">
              <button class="search-button"
                      hx-get="/prep-library-modal/<%= prep.prepId %>"
                      hx-target="#modal-container"
                      hx-swap="innerHTML">Search</button>
            </div>
          </div>
          <%- renderCommandZone() %>

          <div class="shuffle-up-section">
            <form method="post" action="/start-game" class="inline-form">
              <input type="hidden" name="prep-id" value="<%= prep.prepId %>" />
              <input type="hidden" name="expected-version" value="<%= prep.version %>" />
              <button type="submit" class="button-base begin-button">Shuffle Up</button>
            </form>
          </div>
        </div>
    </main>

    <div id="modal-container"></div>
    <div id="card-modal-container"></div>

    <%- include('partials/footer') %>
  </div>

  <script src="/htmx.js"></script>
  <script src="/game.js"></script>
  <script>
    // Configure HTMX with browser tab ID
    document.addEventListener("htmx:configRequest", function (event) {
      if (window.browserTabId) {
        event.detail.headers["X-Browser-Tab-Id"] = window.browserTabId;
      }
    });
  </script>
</body>

</html>
